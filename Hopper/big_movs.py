#x86
doc = Document.getCurrentDocument()
doc.message("Checking big movement of raw data!",['OK'])

for seg in doc.getSegmentsList():
    doc.log('- - -')
    doc.log(seg.getName())

    # is this a big ammount of MOVs?
    mov_threshold = 10

    addr = seg.getStartingAddress()
    addr_end = addr + seg.getLength()
    doc.setCurrentAddress(addr)

    mov_count = 0
    at_addr = 0
    while addr < addr_end:
        inst = seg.getInstructionAtAddress(addr)
        if inst.getInstructionString().startswith("mov") and inst.getRawArgument(1).startswith("0x"):
            if at_addr == 0x0:
                at_addr = addr
            mov_count += 1
        else:
            if mov_count >= mov_threshold:
                print "Big MOVement at addr 0x%x" % (at_addr)
            mov_count = 0
            at_addr = 0
        addr += inst.getInstructionLength()
